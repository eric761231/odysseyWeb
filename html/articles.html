<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta charset="UTF-8">
    <title>每日閱讀</title>
    <style>
        body {
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 50%, #0f3460 100%);
            color: #e0e0e0;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            min-height: 100vh;
            margin: 0;
            display: flex;
            flex-direction: column;
            align-items: center;
        }
        .articles-container {
            background: rgba(30, 30, 45, 0.95);
            border-radius: 20px;
            padding: 40px;
            box-shadow: 0 15px 35px rgba(0, 0, 0, 0.4);
            max-width: 600px;
            width: 90%;
            margin-top: 40px;
        }
        h1 {
            text-align: center;
            font-size: 2em;
            font-weight: 300;
            margin-bottom: 20px;
        }
        a {
            color: #00aaff;
            text-decoration: none;
        }
       .back-btn {
            position: fixed;
            top: 50%;
            right: 24px;
            transform: translateY(-50%);
            width: 48px;
            height: 180px;
            padding: 0;
            background: linear-gradient(180deg, #0f3460 60%, #16213e 100%);
            color: #fff;
            font-size: 1.1em;
            font-weight: 500;
            border-radius: 16px;
            box-shadow: 0 4px 16px rgba(0,0,0,0.18);
            text-decoration: none;
            z-index: 100;
            transition: background 0.2s, box-shadow 0.2s;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            writing-mode: vertical-rl;
            text-align: center;
            letter-spacing: 2px;
        }
        @media (max-width: 600px) {
            .back-btn {
                width: 36px;
                height: 120px;
                font-size: 0.85em;
                border-radius: 10px;
                right: 8px;
                padding: 0;
                box-shadow: 0 2px 8px rgba(0,0,0,0.18);
            }
        }
        
        .back-btn:hover {
            background: linear-gradient(180deg, #16213e 60%, #0f3460 100%);
            box-shadow: 0 8px 24px rgba(0,0,0,0.28);
        }
        .month-item {
            background: #16213e;
            color: #00aaff;
            border-radius: 8px;
            padding: 10px 24px;
            font-size: 1.2em;
            cursor: pointer;
            margin: 8px 0;
            box-shadow: 0 2px 8px rgba(0,0,0,0.12);
            transition: background 0.2s, color 0.2s;
            text-align: center;
        }
        .month-item:hover {
            background: #0f3460;
            color: #fff;
        }
        .articles-slider {
            position: relative;
            margin-top: 16px;
            height: 320px;
        }
        .article-content {
            background: rgba(30,30,45,0.9);
            border-radius: 12px;
            padding: 24px 16px;
            min-width: 320px;
            max-width: 480px;
            max-height: 320px;
            overflow-y: auto;
            box-shadow: 0 2px 8px rgba(0,0,0,0.12);
            /* 隱藏捲動條 Chrome/Safari/Edge */
            scrollbar-width: none; /* Firefox */
            -ms-overflow-style: none; /* IE 10+ */
        }
        .article-content::-webkit-scrollbar {
            display: none;
        }
        /* 按鈕簡約時尚設計 */
        .slide-btn {
            position: absolute;
            top: 50%;
            transform: translateY(-50%);
            background: transparent;
            color: #00aaff;
            border: none;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.8em;
            box-shadow: 0 2px 8px rgba(0,0,0,0.10);
            cursor: pointer;
            transition: background 0.2s, color 0.2s, box-shadow 0.2s;
            outline: none;
        }
        #prev-btn {
            left: 0;
        }
        #next-btn {
            right: 0;
        }
        .slide-btn:disabled {
            background: transparent;
            color: #aaa;
            box-shadow: none;
            cursor: not-allowed;
        }
        .arrow-icon {
            font-family: inherit;
            font-weight: 600;
            font-size: 1.5em;
            line-height: 1;
            display: block;
        }
        .slide-btn:active {
            background: #00aaff22;
            color: #0088cc;
        }
        @media (max-width: 600px) {
            .article-content {
                min-width: 180px;
                max-width: 95vw;
                padding: 16px 8px;
            }
            .slide-btn {
                width: 36px;
                height: 36px;
                font-size: 1.5em;
            }
        }
    </style>
</head>
<body>
    <a href="index.html" class="back-btn">返回冥想音樂</a>
    <div class="articles-container">
        <h1>每日閱讀</h1>
        <div id="month-list">
            <!-- 月份列表 -->
            <div class="month-item" data-month="4">4月</div>
            <div class="month-item" data-month="5">5月</div>
            <div class="month-item" data-month="6">6月</div>
            <div class="month-item" data-month="7">7月</div>
            <div class="month-item" data-month="8">8月</div>
            <div class="month-item" data-month="9">9月</div>
            <div class="month-item" data-month="10">10月</div>
        </div>
        <div id="articles-panel"></div>
    </div>
    <script>
// 取代 articlesData，動態讀取 txt 檔案

let articlesData = {};
const articlesPanel = document.getElementById('articles-panel');
const monthList = document.getElementById('month-list');
let expandedMonth = null;
let currentPage = 0;
const pageSize = 1;
const monthFolders = [4,5,6,7,8,9,10].map(m => `2025-${String(m).padStart(2,'0')}`);

// 載入 JSON 檔案
async function loadArticlesJson() {
    try {
        // 以相對路徑載入，確保本地與 Vercel 都能用
        const res = await fetch('articles/articles.json');
        if (!res.ok) throw new Error('載入失敗');
        articlesData = await res.json();
    } catch (e) {
        articlesPanel.innerHTML = '<div style="color:red;">無法載入文章列表，請確認 articles.json 路徑與格式。</div>';
        articlesData = {};
    }
}

function renderArticles(month, page) {
    const files = articlesData[month] || [];
    if (!files.length) {
        articlesPanel.innerHTML = '<div>本月無文章</div>';
        return;
    }
    page = Math.max(0, Math.min(page, files.length-1));
    const article = files[page];
    const fileDate = article.date;
    let text = article.content;
    let lines = text.split('\n');
    // 移除首尾空白行
    while (lines.length && lines[0].trim() === '') lines.shift();
    while (lines.length && lines[lines.length-1].trim() === '') lines.pop();
    // 合併多個空白行為一行
    for (let i = lines.length-2; i >= 0; i--) {
        if (lines[i].trim() === '' && lines[i+1].trim() === '') {
            lines.splice(i+1, 1);
        }
    }
    // 讓首行『ODYSSEY 溯源課程』左對齊，『閱讀功課』右對齊
    if (lines[0] && lines[0].includes('ODYSSEY 溯源課程') && lines[0].includes('閱讀功課')) {
        const parts = lines[0].split('閱讀功課');
        lines[0] = `<div style='display:flex;'><div style='flex:1;text-align:left;'>${parts[0].trim()}</div><div style='flex:1;text-align:right;'>閱讀功課</div></div>`;
    }
    // 在星期的英文前面加上檔案日期
    for (let i = 0; i < lines.length; i++) {
        if (/星期[一二三四五六日] +[A-Za-z]+/.test(lines[i])) {
            lines[i] = `${fileDate} ${lines[i]}`;
            break;
        }
    }
    const htmlContent = lines.join('\n');
    let html = `<div class="articles-slider">`
        + `<button class="slide-btn" id="prev-btn" ${page===0?'disabled':''} aria-label="上一頁"><span class="arrow-icon">&lt;</span></button>`
        + `<div class="article-content" style="white-space:pre-line; margin: 0 48px;">`
        + `${htmlContent}`
        + `<div style="text-align:center; color:#00aaff; margin-top:24px;">${page+1} / ${files.length}</div>`
        + `</div>`
        + `<button class="slide-btn" id="next-btn" ${page===files.length-1?'disabled':''} aria-label="下一頁"><span class="arrow-icon">&gt;</span></button>`
        + `</div>`;
    articlesPanel.innerHTML = html;
    document.getElementById('prev-btn').onclick = function() {
        if (page > 0) renderArticles(month, page-1);
    };
    document.getElementById('next-btn').onclick = function() {
        if (page < files.length-1) renderArticles(month, page+1);
    };
}

monthList.addEventListener('click', async function(e) {
    if (e.target.classList.contains('month-item')) {
        const month = e.target.dataset.month;
        if (expandedMonth === month) {
            expandedMonth = null;
            articlesPanel.innerHTML = '';
        } else {
            expandedMonth = month;
            currentPage = 0;
            if (!Object.keys(articlesData).length) await loadArticlesJson();
            renderArticles(`2025-${String(month).padStart(2,'0')}`, currentPage);
        }
    }
});
    </script>
</body>
</html>
